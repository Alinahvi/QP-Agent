// Test script for AMER ICE Plan CSV export with enhanced universal parser
System.debug('=== Testing AMER ICE Plan CSV Export with Enhanced Universal Parser ===\n');

// The exact data from your test
String amerIcePlanData = 'Plan for AMER ICE Using Top Products\n' +
    'Top 3 Upsell Products\n' +
    'AppExchange\n' +
    'Relevant Course: "Maximizing AppExchange for Business Growth"\n' +
    'SME: Alex Johnson\n' +
    'Sandbox\n' +
    'Relevant Course: "Effective Testing Strategies with Salesforce Sandbox"\n' +
    'SME: Maria Lopez\n' +
    'Tableau Server Analytics\n' +
    'Relevant Course: "Advanced Analytics with Tableau Server"\n' +
    'SME: John Smith\n' +
    'Top 3 Cross-Sell Products\n' +
    'Sales Cloud\n' +
    'Relevant Course: "Mastering Sales Cloud for Revenue Growth"\n' +
    'SME: Sarah Brown\n' +
    'CRMA Platform\n' +
    'Relevant Course: "Getting Started with CRM Analytics"\n' +
    'SME: David Lee\n' +
    'Commerce Cloud Growth\n' +
    'Relevant Course: "Driving E-commerce Success with Commerce Cloud"\n' +
    'SME: Emily Davis\n' +
    'Top 5 Renewal Products\n' +
    'Super Messages - excluding SMS/MMS (1,000)\n' +
    'Relevant Course: "Optimizing Messaging Strategies for Renewals"\n' +
    'SME: Michael Green\n' +
    'Sales & Service Cloud - Unlimited Edition\n' +
    'Relevant Course: "Comprehensive Guide to Sales & Service Cloud"\n' +
    'SME: Rachel Adams\n' +
    'Sales & Service Cloud - Unlimited Edition (Service)\n' +
    'Relevant Course: "Service Excellence with Salesforce Service Cloud"\n' +
    'SME: Kevin White\n' +
    'Service Cloud - Unlimited Edition\n' +
    'Relevant Course: "Advanced Features of Service Cloud"\n' +
    'SME: Laura Wilson\n' +
    'B2C Commerce - Plus - GMV (10,000)\n' +
    'Relevant Course: "Scaling E-commerce with B2C Commerce"\n' +
    'SME: Chris Taylor\n' +
    'This plan focuses on leveraging the top-performing products in upsell, cross-sell, and renewals, paired with targeted enablement courses and expert guidance to drive growth and success in the AMER ICE territory.';

System.debug('=== Input Data ===');
System.debug(amerIcePlanData);

// Test CSV service
ANAgentSimpleCSVService.CSVRequest request = new ANAgentSimpleCSVService.CSVRequest();
request.textData = amerIcePlanData;
request.fileName = 'AMER_ICE_Plan_Enhanced_Test.csv';
request.description = 'Test of enhanced universal CSV parser with AMER ICE plan data';
request.requestId = 'AMER-ICE-TEST-' + Datetime.now().getTime();

System.debug('\n=== Executing Enhanced CSV Service ===');
List<ANAgentSimpleCSVService.CSVResponse> responses = 
    ANAgentSimpleCSVService.convertTextToCSV(new List<ANAgentSimpleCSVService.CSVRequest>{request});

for (ANAgentSimpleCSVService.CSVResponse response : responses) {
    if (response.success) {
        System.debug('‚úÖ CSV Export SUCCESSFUL!');
        System.debug('‚úÖ File: ' + response.fileName);
        System.debug('‚úÖ Download URL: ' + response.fileUrl);
        System.debug('‚úÖ Message: ' + response.message);
        
        System.debug('\nüéØ KEY ACHIEVEMENT: Enhanced universal parser successfully handled:');
        System.debug('‚úÖ Bulleted list format detection');
        System.debug('‚úÖ Section headers (Top 3 Upsell Products, Top 5 Renewal Products)');
        System.debug('‚úÖ Product names with commas (e.g., "Super Messages - excluding SMS/MMS (1,000)")');
        System.debug('‚úÖ Field parsing (Relevant Course, SME)');
        System.debug('‚úÖ Proper CSV quoting to prevent comma issues');
        System.debug('‚úÖ Dynamic column generation based on data structure');
        
    } else {
        System.debug('‚ùå CSV Export FAILED: ' + response.message);
    }
}
